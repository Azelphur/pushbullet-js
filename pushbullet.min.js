var PushBullet=function(){var e={},t="https://api.pushbullet.com/v2/",n=t+"pushes",r=t+"contacts",a=t+"devices",o=t+"users/me",i=t+"upload-request",u=4,p=200,d=204;e.APIKey=null,e.push=function(e,t,r,a,o){var i=new FormData;if(i.append(e.toLowerCase()),r&&t){var u=new Error("Cannot push to both device and contact");if(o)return o(u);throw u}if(r)i.append("email",r);else{if(!t){var u=new Error("Must push to either device or contact");if(o)return o(u);throw u}i.append("device_iden",t)}switch(e.toLowerCase()){case"note":i.append("title",a.title),i.append("body",a.body);break;case"link":i.append("title",a.title),i.append("url",a.url),a.body&&i.append("body",a.body);break;case"address":i.append("name",a.name),i.append("address",a.address);break;case"list":i.append("title",a.title),i.append("items",a.items);break;default:var u=new Error("Invalid type");if(o)return o(u);throw u}var p=l(n,"POST",i,!1,o);return o?void 0:p},e.pushFile=function(e,t,n,r,a){var o="file_type="+encodeURIComponent(n.type),u="file_name="+encodeURIComponent(n.name),p=i+"?"+o+"&"+u,d=a?function(o,i){if(o)return a(o);try{s(i,e,t,n,r,a)}catch(o){return a(o)}}:null,c=l(p,"GET",null,!1,d);return a?void 0:s(c,n)};var s=function(e,t,r,a,o,i){var u=new FormData;u.append("awsaccesskeyid",e.data.awsaccesskeyid),u.append("acl",e.data.acl),u.append("key",e.data.key),u.append("signature",e.data.signature),u.append("policy",e.data.policy),u.append("content-type",a.type),u.append("file",a),l(e.upload_url,"POST",u,!0,null);var p=new FormData;if(p.append("file_name",a.name),p.append("file_type",a.type),p.append("file_url",e.file_url),p.append("type","file"),o&&p.append("body",o),r&&t){var d=new Error("Cannot push to both device and contact");if(i)return i(d);throw d}if(r)p.append("email",r);else{if(!t){var d=new Error("Must push to either device or contact");if(i)return i(d);throw d}p.append("device_iden",t)}var s=l(n,"POST",p,!1,i);return i?void 0:s};e.deletePush=function(e,t){var r=l(n+"/"+e,"DELETE",null,!1,t);return t?void 0:r},e.pushHistory=function(e){var t=l(n,"GET",null,!1,e);return e?void 0:t},e.devices=function(e){var t=l(a,"GET",null,!1,e);return e?void 0:t},e.deleteDevice=function(e,t){var n=l(a+"/"+e,"DELETE",null,!1,t);return t?void 0:n},e.contacts=function(e){var t=l(r,"GET",null,!1,e);return e?void 0:t},e.deleteContact=function(e,t){var n=l(r+"/"+e,null,!1,t);return t?void 0:n},e.user=function(e){var t=l(o,"GET",null,!1,e);return e?void 0:t};var l=function(t,n,r,a,o){if(!e.APIKey){var i=new Error("API Key for Pushbullet not set");if(o)return o(i);throw i}var p=new XMLHttpRequest,d=!1;return o&&(d=!0,p.onreadystatechange=function(){if(p.readyState===u){var e=null;try{e=c(p)}catch(t){return o(t)}return o(null,e)}}),p.open(n,t,d),a||p.setRequestHeader("Authorization","Basic "+window.btoa(e.APIKey+":")),p.send(r),d?void 0:c(p)},c=function(e){if(e.status!==p&&e.status!==d)throw new Error(e.status+": "+e.response);try{return JSON.parse(e.response)}catch(t){return e.response}};return e}();
